version: '3.9'

services:
  news-checker-api:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: news-checker-api
    command: uv run --system api/api.py
    volumes:
      - .:/app
    depends_on:
      - news-checker-redis
      - news-checker-mongodb
    networks:
      - news-checker-network
    restart: always
    ports:
      - 11111:11111
    expose:
      - 11111
    env_file:
      - .env

  news-checker-worker:
    build:
      context: .
      dockerfile: Dockerfile
    command: uv run --system worker/agent.py
    container_name: news-checker-worker
    volumes:
      - .:/app
    depends_on:
      - news-checker-redis
      - news-checker-mongodb
    networks:
      - news-checker-network
    restart: always
    env_file:
      - .env

  news-checker-bot:
    build:
      context: .
      dockerfile: Dockerfile
    command: uv run --system bot.py
    container_name: news-checker-bot
    volumes:
      - .:/app
    depends_on:
      - news-checker-api
      - news-checker-worker
      - news-checker-redis
      - news-checker-mongodb
    networks:
      - news-checker-network
    restart: always
    env_file:
      - .env

  news-checker-redis:
    image: redis:latest
    volumes:
      - ./redis-data:/data
    container_name: news-checker-redis
    networks:
      - news-checker-network
    restart: always

  news-checker-mongodb:
    image: mongo:latest
    volumes:
      - ./mongo-data:/data/db
    networks:
      - news-checker-network
    container_name: news-checker-mongodb
    ports:
      - 27024:27024
    expose:
      - 27024
    command: ["mongod", "--port", "27024"]
    environment:
      MONGO_INITDB_ROOT_USERNAME: news_checker
      MONGO_INITDB_ROOT_PASSWORD: c6a7ec6baeee3795873fb741b6445fdd
    restart: always
    
networks:
  news-checker-network:
    driver: bridge

volumes:
  redis-data:
  mongo-data:
